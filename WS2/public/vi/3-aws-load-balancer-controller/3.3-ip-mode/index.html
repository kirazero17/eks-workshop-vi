<!DOCTYPE html>
<html lang="vi" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.122.0">
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title> :: TERRAFORM ON AWS WORKSHOP</title>

    
    <link href="/css/nucleus.css?1711702844" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1711702844" rel="stylesheet">
    <link href="/css/hybrid.css?1711702844" rel="stylesheet">
    <link href="/css/featherlight.min.css?1711702844" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1711702844" rel="stylesheet">
    <link href="/css/auto-complete.css?1711702844" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1711702844" rel="stylesheet">
    <link href="/css/theme.css?1711702844" rel="stylesheet">
    <link href="/css/hugo-theme.css?1711702844" rel="stylesheet">
    
    <link href="/css/theme-workshop.css?1711702844" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1711702844"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/vi/3-aws-load-balancer-controller/3.3-ip-mode/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1711702844"></script>
<script type="text/javascript" src="/js/auto-complete.js?1711702844"></script>
<script type="text/javascript">
    
        var baseurl = "\/vi";
    
</script>
<script type="text/javascript" src="/js/search.js?1711702844"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/vi/1-introduce/" title="Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-introduce/">
          <b> 1. </b>Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/1-introduce/1.1-replicasets/" title="ReplicaSets" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-introduce/1.1-replicasets/">
          <b> 1.1 </b>ReplicaSets
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/1-introduce/1.2-deployments/" title="Deployments" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-introduce/1.2-deployments/">
          <b> 1.2 </b>Deployments
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/1-introduce/1.3-namespaces/" title="Namespaces" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-introduce/1.3-namespaces/">
          <b> 1.3 </b>Namespaces
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/1-introduce/1.4-kubernetes-services/" title="Kubernetes Services" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-introduce/1.4-kubernetes-services/">
          <b> 1.4 </b>Kubernetes Services
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/1-introduce/1.5-clusterip/" title="ClusterIP" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-introduce/1.5-clusterip/">
          <b> 1.5 </b>ClusterIP
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/2-prerequiste/" title="Các Bước Chuẩn Bị" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-prerequiste/">
          <b> 2. </b>Các Bước Chuẩn Bị
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/3-aws-load-balancer-controller/" title="Giới thiệu" class="dd-item 
        parent
        
        
        ">
      <a href="/vi/3-aws-load-balancer-controller/">
          <b> 3. </b>Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/3-aws-load-balancer-controller/3.1-introduction/" title="Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-aws-load-balancer-controller/3.1-introduction/">
          <b> 3.1 </b>Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-aws-load-balancer-controller/3.2-creating-the-load-balancer/" title="" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-aws-load-balancer-controller/3.2-creating-the-load-balancer/">
          
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-aws-load-balancer-controller/3.3-ip-mode/" title="" class="dd-item 
        
        active
        
        ">
      <a href="/vi/3-aws-load-balancer-controller/3.3-ip-mode/">
          
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/4-ingress/" title="Ingress" class="dd-item 
        
        
        
        ">
      <a href="/vi/4-ingress/">
          <b> 4. </b>Ingress
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/4-ingress/4.1-introduction/" title="Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="/vi/4-ingress/4.1-introduction/">
          <b> 4.1 </b>Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/4-ingress/4.2-creating-the-ingress/" title="Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="/vi/4-ingress/4.2-creating-the-ingress/">
          <b> 4.2 </b>Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/4-ingress/4.3-multiple-ingress-pattern/" title="Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="/vi/4-ingress/4.3-multiple-ingress-pattern/">
          <b> 4.3 </b>Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="http://awsstudygroup.com"><i class='fab fa-aws'></i> AWS Study Group - Blog</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj"><i class='fab fa-facebook'></i> AWS Study Group - Nhóm FB</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="/vi/3-aws-load-balancer-controller/3.3-ip-mode/" selected>Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=11626245&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>26-02-2024</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
            <i> <a href="https://www.linkedin.com/in/jotaguy"  style="color:orange">Gia Hưng </a> <br>
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/vi/'>Kubernetes trên AWS</a> > <a href='/vi/3-aws-load-balancer-controller/'>Giới thiệu</a> > 
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#pre-b-33-b">title: &ldquo;IP mode&rdquo;
date: &ldquo;<code>r Sys.Date()</code>&rdquo;
weight: 3
chapter: false
pre: &ldquo;<!-- raw HTML omitted --> 3.3 <!-- raw HTML omitted -->&rdquo;</a>
      <ul>
        <li></li>
        <li><a href="#tái-cấu-hình-nlb">Tái cấu hình NLB</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              
            </h1>
          

        



	<h2 id="pre-b-33-b">title: &ldquo;IP mode&rdquo;
date: &ldquo;<code>r Sys.Date()</code>&rdquo;
weight: 3
chapter: false
pre: &ldquo;<!-- raw HTML omitted --> 3.3 <!-- raw HTML omitted -->&rdquo;</h2>
<h4 id="ip-mode">IP mode</h4>
<p>Như đã đề cập trước đó, NLB chúng ta đã tạo đang hoạt động ở chế độ &ldquo;instance mode&rdquo;. Chế độ mục tiêu instance hỗ trợ các pod đang chạy trên các máy EC2 của AWS. Trong chế độ này, AWS NLB gửi lưu lượng đến các instance và <code>kube-proxy</code> trên các nút làm việc cá nhân chuyển tiếp nó đến các pod thông qua một hoặc nhiều nút làm việc trong cụm Kubernetes.</p>
<p>Bộ điều khiển Cân bằng Tải AWS cũng hỗ trợ tạo NLB hoạt động ở chế độ &ldquo;IP mode&rdquo;. Trong chế độ này, AWS NLB gửi lưu lượng trực tiếp đến các pod Kubernetes đằng sau dịch vụ, loại bỏ nhu cầu cho một bước nhảy mạng phụ qua các nút làm việc trong cụm Kubernetes. Chế độ mục tiêu IP hỗ trợ các pod đang chạy trên cả các máy EC2 của AWS và AWS Fargate.</p>
<p><img src="./assets/ip-mode.png" alt="Chế độ IP"></p>
<p>Có một số lý do mà chúng ta có thể muốn cấu hình NLB để hoạt động ở chế độ mục tiêu IP:</p>
<ol>
<li>Tạo một đường mạng hiệu quả hơn cho các kết nối đến, bỏ qua <code>kube-proxy</code> trên nút làm việc EC2</li>
<li>Loại bỏ nhu cầu xem xét các khía cạnh như <code>externalTrafficPolicy</code> và các tùy chọn cấu hình khác nhau của nó</li>
<li>Một ứng dụng đang chạy trên Fargate thay vì EC2</li>
</ol>
<h3 id="tái-cấu-hình-nlb">Tái cấu hình NLB</h3>
<p>Hãy tái cấu hình NLB của chúng ta để sử dụng chế độ IP và xem xét tác động của nó đối với cơ sở hạ tầng.</p>
<p>Đây là đoạn mã patch chúng ta sẽ áp dụng để tái cấu hình Dịch vụ:</p>
<pre tabindex="0"><code class="language-kustomization" data-lang="kustomization">modules/exposing/load-balancer/ip-mode/nlb.yaml
Service/ui-nlb
</code></pre><p>Áp dụng các bản mẫu với kustomize:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ kubectl apply -k ~/environment/eks-workshop/modules/exposing/load-balancer/ip-mode
</span></span></code></pre></div><p>Sẽ mất vài phút để cấu hình của cân bằng tải được cập nhật. Chạy lệnh sau để đảm bảo chú thích được cập nhật:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ kubectl describe service/ui-nlb -n ui
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>Annotations:              service.beta.kubernetes.io/aws-load-balancer-nlb-target-type: ip
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>Bạn nên có thể truy cập ứng dụng bằng cùng một URL như trước đó, với NLB bây giờ sử dụng chế độ IP để tiết lộ ứng dụng của bạn.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ ALB_ARN<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>aws elbv2 describe-load-balancers --query <span style="color:#e6db74">&#39;LoadBalancers[?contains(LoadBalancerName, `k8s-ui-uinlb`) == `true`].LoadBalancerArn&#39;</span> | jq -r <span style="color:#e6db74">&#39;.[0]&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>$ TARGET_GROUP_ARN<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>aws elbv2 describe-target-groups --load-balancer-arn $ALB_ARN | jq -r <span style="color:#e6db74">&#39;.TargetGroups[0].TargetGroupArn&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>$ aws elbv2 describe-target-health --target-group-arn $TARGET_GROUP_ARN
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;TargetHealthDescriptions&#34;</span>: <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Target&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;Id&#34;</span>: <span style="color:#e6db74">&#34;10.42.180.183&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;Port&#34;</span>: 8080,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;AvailabilityZone&#34;</span>: <span style="color:#e6db74">&#34;us-west-2a&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;HealthCheckPort&#34;</span>: <span style="color:#e6db74">&#34;8080&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;TargetHealth&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;State&#34;</span>: <span style="color:#e6db74">&#34;initial&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;Reason&#34;</span>: <span style="color:#e6db74">&#34;Elb.RegistrationInProgress&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;Description&#34;</span>: <span style="color:#e6db74">&#34;Target registration is in progress&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p><strong>Chú ý:</strong> Chúng ta đã chuyển từ 3 mục tiêu mà chúng ta đã quan sát trong phần trước đó thành chỉ một mục tiêu. Tại sao lại như vậy? Thay vì đăng ký các EC2 instances trong cụm EKS của chúng ta, bộ điều khiển cân bằng tải hiện đang đăng ký các Pods cá nhân và gửi lưu lượng trực tiếp, tận dụng AWS VPC CNI và sự thật rằng mỗi Pod đều có địa chỉ IP VPC cấp đầu.</p>
<p>Hãy mở rộng thành phần ui lên 3 bản sao và xem điều gì xảy ra:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ kubectl scale -n ui deployment/ui --replicas<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>$ kubectl wait --for<span style="color:#f92672">=</span>condition<span style="color:#f92672">=</span>Ready pod -n ui -l app.kubernetes.io/name<span style="color:#f92672">=</span>ui --timeout<span style="color:#f92672">=</span>60s
</span></span></code></pre></div><p>Bây giờ hãy kiểm tra lại các mục tiêu của cân bằng tải:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ ALB_ARN<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>aws elbv2 describe-load-balancers --query <span style="color:#e6db74">&#39;LoadBalancers[?contains(LoadBalancerName, `k8s-ui-uinlb`) == `true`].LoadBalancerArn&#39;</span> | jq -r <span style="color:#e6db74">&#39;.[0]&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>$ TARGET_GROUP_ARN<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>aws elbv2 describe-target-groups --load-balancer-arn $ALB_ARN | jq -r <span style="color:#e6db74">&#39;.TargetGroups[0].TargetGroupArn&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>$ aws elbv2 describe-target-health --target-group-arn $TARGET_GROUP_ARN
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;TargetHealthDescriptions&#34;</span>: <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Target&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;Id&#34;</span>: <span style="color:#e6db74">&#34;10.42.180.181&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;Port&#34;</span>: 8080,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;AvailabilityZone&#34;</span>: <span style="color:#e6db74">&#34;us-west-2c&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;HealthCheckPort&#34;</span>: <span style="color:#e6db74">&#34;8080&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;TargetHealth&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;State&#34;</span>: <span style="color:#e6db74">&#34;initial&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;Reason&#34;</span>: <span style="color:#e6db74">&#34;Elb.RegistrationInProgress&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;Description&#34;</span>: <span style="color:#e6db74">&#34;Target registration is in progress&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Target&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;Id&#34;</span>: <span style="color:#e6db74">&#34;10.42.140.129&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;Port&#34;</span>: 8080,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;AvailabilityZone&#34;</span>: <span style="color:#e6db74">&#34;us-west-2a&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;HealthCheckPort&#34;</span>: <span style="color:#e6db74">&#34;8080&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;TargetHealth&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;State&#34;</span>: <span style="color:#e6db74">&#34;healthy&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;Target&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;Id&#34;</span>: <span style="color:#e6db74">&#34;10.42.105.38&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;Port&#34;</span>: 8080,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;AvailabilityZone&#34;</span>: <span style="color:#e6db74">&#34;us-west-2a&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;HealthCheckPort&#34;</span>: <span style="color:#e6db74">&#34;8080&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;TargetHealth&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;State&#34;</span>: <span style="color:#e6db74">&#34;initial&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;Reason&#34;</span>: <span style="color:#e6db74">&#34;Elb.RegistrationInProgress&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;Description&#34;</span>: <span style="color:#e6db74">&#34;Target registration is in progress&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>Như dự kiến, bây giờ chúng ta có 3 mục tiêu, khớp với số lượng bản sao trong Deployment ui.</p>
<p>Nếu bạn muốn chờ đợi để đảm bảo ứng dụng vẫn hoạt động như trước, hãy chạy lệnh sau. Nếu không, bạn có thể tiếp tục sang module tiếp theo.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ wait-for-lb <span style="color:#66d9ef">$(</span>kubectl get service -n ui ui-nlb -o jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{.status.loadBalancer.ingress[*].hostname}{&#39;\n&#39;}&#34;</span><span style="color:#66d9ef">)</span>
</span></span></code></pre></div>




<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/vi/3-aws-load-balancer-controller/3.2-creating-the-load-balancer/" title=""> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/vi/4-ingress/" title="Ingress" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1711702844"></script>
    <script src="/js/perfect-scrollbar.min.js?1711702844"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1711702844"></script>
    <script src="/js/jquery.sticky.js?1711702844"></script>
    <script src="/js/featherlight.min.js?1711702844"></script>
    <script src="/js/highlight.pack.js?1711702844"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1711702844"></script>
    <script src="/js/learn.js?1711702844"></script>
    <script src="/js/hugo-learn.js?1711702844"></script>

    <link href="/mermaid/mermaid.css?1711702844" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1711702844"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
