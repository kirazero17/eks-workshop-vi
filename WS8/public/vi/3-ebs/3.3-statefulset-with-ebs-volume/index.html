<!DOCTYPE html>
<html lang="vi" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.122.0">
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Các Bước Chuẩn Bị :: KUBERNETES ON AWS WORKSHOP</title>

    
    <link href="/css/nucleus.css?1711440727" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1711440727" rel="stylesheet">
    <link href="/css/hybrid.css?1711440727" rel="stylesheet">
    <link href="/css/featherlight.min.css?1711440727" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1711440727" rel="stylesheet">
    <link href="/css/auto-complete.css?1711440727" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1711440727" rel="stylesheet">
    <link href="/css/theme.css?1711440727" rel="stylesheet">
    <link href="/css/hugo-theme.css?1711440727" rel="stylesheet">
    
    <link href="/css/theme-workshop.css?1711440727" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1711440727"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/vi/3-ebs/3.3-statefulset-with-ebs-volume/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1711440727"></script>
<script type="text/javascript" src="/js/auto-complete.js?1711440727"></script>
<script type="text/javascript">
    
        var baseurl = "\/vi";
    
</script>
<script type="text/javascript" src="/js/search.js?1711440727"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/vi/1-introduce/" title="Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-introduce/">
          <b> 1. </b>Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/1-introduce/1.1-docker-storage/" title="Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-introduce/1.1-docker-storage/">
          <b> 1.1 </b>Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/1-introduce/1.2-storage/" title="Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-introduce/1.2-storage/">
          <b> 1.2 </b>Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/1-introduce/1.3-volume-driver-plugins-in-docker/" title="Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-introduce/1.3-volume-driver-plugins-in-docker/">
          <b> 1.3 </b>Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/1-introduce/1.4-container-storage-interface/" title="Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-introduce/1.4-container-storage-interface/">
          <b> 1.4 </b>Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/1-introduce/1.5-volumes/" title="Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-introduce/1.5-volumes/">
          <b> 1.5 </b>Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/1-introduce/1.6-persistent-volumes/" title="Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-introduce/1.6-persistent-volumes/">
          <b> 1.6 </b>Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/1-introduce/1.7-persistent-volume-claims/" title="Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-introduce/1.7-persistent-volume-claims/">
          <b> 1.7 </b>Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/1-introduce/1.8-using-pvc-in-pods/" title="Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-introduce/1.8-using-pvc-in-pods/">
          <b> 1.8 </b>Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/1-introduce/1.9-storage-class/" title="Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="/vi/1-introduce/1.9-storage-class/">
          <b> 1.9 </b>Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/2-prerequiste/" title="Các Bước Chuẩn Bị" class="dd-item 
        
        
        
        ">
      <a href="/vi/2-prerequiste/">
          <b> 2. </b>Các Bước Chuẩn Bị
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/3-ebs/" title="Các Bước Chuẩn Bị" class="dd-item 
        parent
        
        
        ">
      <a href="/vi/3-ebs/">
          <b> 3. </b>Các Bước Chuẩn Bị
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/3-ebs/3.1-statefulsets/" title="Các Bước Chuẩn Bị" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-ebs/3.1-statefulsets/">
          <b> 3.1 </b>Các Bước Chuẩn Bị
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-ebs/3.2-ebs-csi-driver/" title="Các Bước Chuẩn Bị" class="dd-item 
        
        
        
        ">
      <a href="/vi/3-ebs/3.2-ebs-csi-driver/">
          <b> 3.2 </b>Các Bước Chuẩn Bị
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/3-ebs/3.3-statefulset-with-ebs-volume/" title="Các Bước Chuẩn Bị" class="dd-item 
        
        active
        
        ">
      <a href="/vi/3-ebs/3.3-statefulset-with-ebs-volume/">
          <b> 3.3 </b>Các Bước Chuẩn Bị
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vi/4-amazon-efs/" title="Các Bước Chuẩn Bị" class="dd-item 
        
        
        
        ">
      <a href="/vi/4-amazon-efs/">
          <b> 4. </b>Các Bước Chuẩn Bị
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/vi/4-amazon-efs/4.1/" title="Các Bước Chuẩn Bị" class="dd-item 
        
        
        
        ">
      <a href="/vi/4-amazon-efs/4.1/">
          <b> 4.1 </b>Các Bước Chuẩn Bị
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/4-amazon-efs/4.2/" title="Các Bước Chuẩn Bị" class="dd-item 
        
        
        
        ">
      <a href="/vi/4-amazon-efs/4.2/">
          <b> 4.2 </b>Các Bước Chuẩn Bị
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/vi/4-amazon-efs/4.3/" title="Các Bước Chuẩn Bị" class="dd-item 
        
        
        
        ">
      <a href="/vi/4-amazon-efs/4.3/">
          <b> 4.3 </b>Các Bước Chuẩn Bị
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="http://awsstudygroup.com"><i class='fab fa-aws'></i> AWS Study Group - Blog</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj"><i class='fab fa-facebook'></i> AWS Study Group - Nhóm FB</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="/vi/3-ebs/3.3-statefulset-with-ebs-volume/" selected>Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=11626245&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>26-02-2024</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
            <i> <a href="https://www.linkedin.com/in/jotaguy"  style="color:orange">Gia Hưng </a> <br>
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/vi/'>Kubernetes trên AWS</a> > <a href='/vi/3-ebs/'>Các Bước Chuẩn Bị</a> > Các Bước Chuẩn Bị
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Các Bước Chuẩn Bị
            </h1>
          

        



	<h4 id="cập-nhật-mysql-db-cho-dịch-vụ-catalog-sử-dụng-ebs-volume">Cập nhật MySQL DB cho dịch vụ Catalog sử dụng EBS Volume</h4>
<p>Bây giờ khi chúng ta đã hiểu về <a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/">StatefulSets</a> và <a href="https://kubernetes.io/docs/concepts/storage/dynamic-provisioning/">Dynamic Volume Provisioning</a>, hãy thay đổi MySQL DB trên dịch vụ Catalog để cung cấp một EBS volume mới để lưu trữ các tập tin cơ sở dữ liệu một cách liên tục.</p>
<p><img src="./assets/mysql-ebs.png" alt="MySQL với EBS"></p>
<p>Sử dụng Kustomize, chúng ta sẽ thực hiện hai việc:</p>
<ul>
<li>Tạo một StatefulSet mới cho cơ sở dữ liệu MySQL được sử dụng bởi thành phần catalog sử dụng một EBS volume.</li>
<li>Cập nhật thành phần <code>catalog</code> để sử dụng phiên bản cơ sở dữ liệu mới này.</li>
</ul>
<p>:::info
Tại sao chúng ta không cập nhật StatefulSet hiện có? Các trường chúng ta cần cập nhật là bất biến và không thể thay đổi.
:::</p>
<p>Ở đây trong StatefulSet cơ sở dữ liệu catalog mới:</p>
<pre tabindex="0"><code class="language-file" data-lang="file">manifests/modules/fundamentals/storage/ebs/statefulset-mysql.yaml
</code></pre><p>Chú ý đến trường <code>volumeClaimTemplates</code> mô tả hướng dẫn cho Kubernetes sử dụng Dynamic Volume Provisioning để tạo một EBS Volume mới, một <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/">PersistentVolume (PV)</a> và một <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#persistentvolumeclaims">PersistentVolumeClaim (PVC)</a> tất cả đều tự động.</p>
<p>Đây là cách chúng ta sẽ cấu hình lại thành phần catalog để sử dụng StatefulSet mới:</p>
<pre tabindex="0"><code class="language-kustomization" data-lang="kustomization">modules/fundamentals/storage/ebs/deployment.yaml
Deployment/catalog
</code></pre><p>Áp dụng các thay đổi và chờ đợi các Pod mới được triển khai:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ kubectl apply -k ~/environment/eks-workshop/modules/fundamentals/storage/ebs/
</span></span><span style="display:flex;"><span>$ kubectl rollout status --timeout<span style="color:#f92672">=</span>100s statefulset/catalog-mysql-ebs -n catalog
</span></span></code></pre></div><p>Bây giờ hãy xác nhận rằng StatefulSet mới triển khai của chúng ta đang chạy:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ kubectl get statefulset -n catalog catalog-mysql-ebs
</span></span><span style="display:flex;"><span>NAME                READY   AGE
</span></span><span style="display:flex;"><span>catalog-mysql-ebs   1/1     79s
</span></span></code></pre></div><p>Kiểm tra StatefulSet <code>catalog-mysql-ebs</code> của chúng ta, chúng ta có thể thấy rằng bây giờ chúng ta có một PersistentVolumeClaim được đính kèm với dung lượng 30GiB và với <code>storageClassName</code> là gp2.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ kubectl get statefulset -n catalog catalog-mysql-ebs <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -o jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{.spec.volumeClaimTemplates}&#39;</span> | jq .
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;apiVersion&#34;</span>: <span style="color:#e6db74">&#34;v1&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;kind&#34;</span>: <span style="color:#e6db74">&#34;PersistentVolumeClaim&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;metadata&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;creationTimestamp&#34;</span>: null,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;data&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;spec&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;accessModes&#34;</span>: <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;ReadWriteOnce&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">]</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;resources&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;requests&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#34;storage&#34;</span>: <span style="color:#e6db74">&#34;30Gi&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;storageClassName&#34;</span>: <span style="color:#e6db74">&#34;gp2&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;volumeMode&#34;</span>: <span style="color:#e6db74">&#34;Filesystem&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;status&#34;</span>: <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;phase&#34;</span>: <span style="color:#e6db74">&#34;Pending&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">]</span>
</span></span></code></pre></div><p>Chúng ta có thể phân tích cách Dynamic Volume Provisioning tạo một PersistentVolume (PV) tự động cho chúng ta:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ kubectl get pv | grep -i catalog
</span></span><span style="display:flex;"><span>pvc-1df77afa-10c8-4296-aa3e-cf2aabd93365   30Gi       RWO            Delete           Bound         catalog/data-catalog-mysql-ebs-0          gp2                            10m
</span></span></code></pre></div><p>Sử dụng <a href="https://aws.amazon.com/cli/">AWS CLI</a>, chúng ta có thể kiểm tra volume Amazon EBS đã được tạo tự động cho chúng ta:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ aws ec2 describe-volumes <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --filters Name<span style="color:#f92672">=</span>tag:kubernetes.io/created-for/pvc/name,Values<span style="color:#f92672">=</span>data-catalog-mysql-ebs-0 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --query <span style="color:#e6db74">&#34;Volumes[*].{ID:VolumeId,Tag:Tags}&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --no-cli-pager
</span></span></code></pre></div><p>Nếu bạn muốn, bạn cũng có thể kiểm tra nó qua <a href="https://console.aws.amazon.com/ec2/home#Volumes">bảng điều khiển AWS</a>, chỉ cần tìm kiếm các EBS volumes với tag có key <code>kubernetes.io/created-for/pvc/name</code> và giá trị là <code>data-catalog-mysql-ebs-0</code>:</p>
<p><img src="./assets/ebsVolumeScrenshot.png" alt="EBS Volume AWS Console Screenshot"></p>
<p>Nếu bạn muốn kiểm tra shell của container và kiểm tra ổ đĩa EBS mới được gắn vào hệ điều hành Linux, hãy chạy lệnh này để thực thi một lệnh shell vào container <code>catalog-mysql-ebs</code>. Nó sẽ kiểm tra các hệ thống tập tin mà bạn đã gắn kết:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ kubectl exec --stdin catalog-mysql-ebs-0  -n catalog -- bash -c <span style="color:#e6db74">&#34;df -h&#34;</span>
</span></span><span style="display:flex;"><span>Filesystem      Size  Used Avail Use% Mounted on
</span></span><span style="display:flex;"><span>overlay         100G  7.6G   93G   8% /
</span></span><span style="display:flex;"><span>tmpfs            64M     <span style="color:#ae81ff">0</span>   64M   0% /dev
</span></span><span style="display:flex;"><span>tmpfs           3.8G     <span style="color:#ae81ff">0</span>  3.8G   0% /sys/fs/cgroup
</span></span><span style="display:flex;"><span>/dev/nvme0n1p1  100G  7.6G   93G   8% /etc/hosts
</span></span><span style="display:flex;"><span>shm              64M     <span style="color:#ae81ff">0</span>   64M   0% /dev/shm
</span></span><span style="display:flex;"><span>/dev/nvme1n1     30G  211M   30G   1% /var/lib/mysql
</span></span><span style="display:flex;"><span>tmpfs           7.0G   12K  7.0G   1% /run/secrets/kubernetes.io/serviceaccount
</span></span><span style="display:flex;"><span>tmpfs           3.8G     <span style="color:#ae81ff">0</span>  3.8G   0% /proc/acpi
</span></span><span style="display:flex;"><span>tmpfs           3.8G     <span style="color:#ae81ff">0</span>  3.8G   0% /sys/firmware
</span></span></code></pre></div><p>Kiểm tra ổ đĩa hiện đang được gắn vào <code>/var/lib/mysql</code>. Đây là Ổ đĩa EBS cho các tập tin cơ sở dữ liệu MySQL có trạng thái được lưu trữ theo cách liên tục.</p>
<p>Bây giờ, hãy thử nghiệm xem dữ liệu của chúng ta có thực sự liên tục hay không. Chúng ta sẽ tạo tệp <code>test.txt</code> giống hệt như chúng ta đã làm trong phần đầu tiên của module này:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ kubectl exec catalog-mysql-ebs-0 -n catalog -- bash -c  <span style="color:#e6db74">&#34;echo 123 &gt; /var/lib/mysql/test.txt&#34;</span>
</span></span></code></pre></div><p>Bây giờ, hãy xác minh rằng tệp <code>test.txt</code> của chúng ta đã được tạo trong thư mục <code>/var/lib/mysql</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ kubectl exec catalog-mysql-ebs-0 -n catalog -- ls -larth /var/lib/mysql/ | grep -i test
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> root  root     <span style="color:#ae81ff">4</span> Oct <span style="color:#ae81ff">18</span> 13:57 test.txt
</span></span></code></pre></div><p>Bây giờ, hãy xóa Pod hiện tại <code>catalog-mysql-ebs</code>, điều này sẽ buộc bộ điều khiển StatefulSet tự động tạo lại nó:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ kubectl delete pods -n catalog catalog-mysql-ebs-0
</span></span><span style="display:flex;"><span>pod <span style="color:#e6db74">&#34;catalog-mysql-ebs-0&#34;</span> deleted
</span></span></code></pre></div><p>Đợi vài giây, và chạy lệnh dưới đây để kiểm tra xem Pod <code>catalog-mysql-ebs</code> đã được tạo lại chưa:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ kubectl wait --for<span style="color:#f92672">=</span>condition<span style="color:#f92672">=</span>Ready pod -n catalog <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -l app.kubernetes.io/component<span style="color:#f92672">=</span>mysql-ebs --timeout<span style="color:#f92672">=</span>60s
</span></span><span style="display:flex;"><span>pod/catalog-mysql-ebs-0 condition met
</span></span><span style="display:flex;"><span>$ kubectl get pods -n catalog -l app.kubernetes.io/component<span style="color:#f92672">=</span>mysql-ebs
</span></span><span style="display:flex;"><span>NAME                  READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>catalog-mysql-ebs-0   1/1     Running   <span style="color:#ae81ff">0</span>          29s
</span></span></code></pre></div><p>Cuối cùng, hãy thực thi trở lại vào shell container MySQL và chạy lệnh <code>ls</code> trên đường dẫn <code>/var/lib/mysql</code> để tìm kiếm tệp <code>test.txt</code> mà chúng ta đã tạo, và xem liệu tệp đã được lưu liên tục hay không:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ kubectl exec catalog-mysql-ebs-0 -n catalog -- ls -larth /var/lib/mysql/ | grep -i test
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> mysql root     <span style="color:#ae81ff">4</span> Oct <span style="color:#ae81ff">18</span> 13:57 test.txt
</span></span><span style="display:flex;"><span>$ kubectl exec catalog-mysql-ebs-0 -n catalog -- cat /var/lib/mysql/test.txt
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">123</span>
</span></span></code></pre></div><p>Như bạn có thể thấy, tệp <code>test.txt</code> vẫn có sẵn sau khi xóa và khởi động lại Pod và với nội dung đúng trên đó là <code>123</code>. Đây là chức năng chính của Khối lưu trữ liên tục (PVs). Amazon EBS đang lưu trữ dữ liệu và giữ dữ liệu của chúng ta an toàn và có sẵn trong một khu vực khả dụng của AWS.</p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/vi/3-ebs/3.2-ebs-csi-driver/" title="Các Bước Chuẩn Bị"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/vi/4-amazon-efs/" title="Các Bước Chuẩn Bị" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1711440727"></script>
    <script src="/js/perfect-scrollbar.min.js?1711440727"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1711440727"></script>
    <script src="/js/jquery.sticky.js?1711440727"></script>
    <script src="/js/featherlight.min.js?1711440727"></script>
    <script src="/js/highlight.pack.js?1711440727"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1711440727"></script>
    <script src="/js/learn.js?1711440727"></script>
    <script src="/js/hugo-learn.js?1711440727"></script>

    <link href="/mermaid/mermaid.css?1711440727" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1711440727"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
